[build]
builder = "nixpacks"
# Explicitly use python3 and python3-pip
 # Nixpacks usually provides python3
buildCommand = "npm config set legacy-peer-deps true && npm install && npm run build && cd backend && python3 -m pip install -r requirements.txt"

[deploy]
startCommand = "cd backend && python3 -m uvicorn share:app --host 0.0.0.0 --port $PORT"
restartPolicyType = "ON_FAILURE"

[nixpacks]
# Force both node and python providers to ensure tools are available
providers = ["node", "python"]

[phases.setup]
# Ensure python3 and pip are installed
nixPkgs = ["nodejs_18", "python310", "python310Packages.pip"]
